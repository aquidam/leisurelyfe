<%= render 'pages/top_bar' %>
<div class="container">
  <h1 class="search-recommendation">Search Results</h1>
  <% @recommendations.each do |recommendation| %>
    <div class="search-item-recommendation">
      <div class="image-container">
        <h2 class="description-name"><%= recommendation.name %></h2>
        <div class="rating"><%= rand(1..5) %>.0
          <i class="fas fa-star"></i>
        </div>
        <img src="<%= recommendation.image_url %>" alt="">
        <div class="overlay-icons">
          <i class="fa-regular fa-heart heart-icon" data-recommendation-id="<%= recommendation.id %>"></i>
        </div>
      </div>
      <div class="labels">
        <span class="label label-<%= recommendation.category %>"><%= recommendation.category.humanize %></span>
      </div>
      <p class="description"><%= truncate(recommendation.description, length: 100) %></p>
      <%= link_to recommendation_path(recommendation), class: "text-decoration-none" do %>
        <button class="btn-custom">Find Out More</button>
      <% end %>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const heartIcons = document.querySelectorAll('.heart-icon');
    heartIcons.forEach(icon => {
      icon.addEventListener('click', function() {
        const recommendationId = icon.dataset.recommendationId;
        const isFavorited = icon.classList.contains('fa-solid');
        const url = isFavorited ? `/recommendations/${recommendationId}/favorite` : `/recommendations/${recommendationId}/favorite`;

        fetch(url, {
          method: isFavorited ? 'DELETE' : 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]') ? document.querySelector('meta[name="csrf-token"]').getAttribute('content') : null
          },
          credentials: 'same-origin'
        }).then(response => response.json())
          .then(data => {
            if (data.status === 'added') {
              icon.classList.remove('fa-regular');
              icon.classList.add('fa-solid');
            } else if (data.status === 'removed') {
              icon.classList.remove('fa-solid');
              icon.classList.add('fa-regular');
            }
          });
      });
    });
  });
</script>
